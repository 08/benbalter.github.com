<!doctype html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

		
	    
	    
	
	
	<title>Regular Expression to Parse Word-style Footnotes into WordPress's Simple Footnotes Format &raquo; Benjamin J. Balter</title>
	<meta property='og:title' content='Regular Expression to Parse Word-style Footnotes into WordPress's Simple Footnotes Format &raquo; Benjamin J. Balter'/>

	<meta property='og:site_name' content='Benjamin J. Balter'/>
	
	
	<meta name="description" content="Regular Expression to automatically parse Microsoft Word's footnote format into a more web-friendly format for WordPress's Simple Footnotes plugin."/>
	<meta property='og:description' content='Regular Expression to automatically parse Microsoft Word's footnote format into a more web-friendly format for WordPress's Simple Footnotes plugin.'/>
	
	
	
	
	<link rel="canonical" href="http://localhost:4000/2011/03/20/regular-expression-to-parse-word-style-footnotes/" />

	<link rel="next" href="http://localhost:4000/2011/04/04/when-all-you-have-is-a-pair-of-bolt-cutters/" title="When all you have is a pair of bolt cutters...
" />
	<link rel="prev" href="http://localhost:4000/2011/03/09/craft-your-personal-brand/" title="Using WordPress to Craft Your Personal Brand
" />

	<meta property='og:url' content='http://localhost:4000/2011/03/20/regular-expression-to-parse-word-style-footnotes/'/>
	<link rel="alternate" type="application/rss+xml" title="Benjamin J. Balter &raquo; Feed" href="" />
	
	<meta property='og:locale' content='en_us'/>


	<meta name="viewport" content="width=device-width">

	<link rel="stylesheet" href="http://localhost:4000/assets/css/style.css">
	<script src="http://localhost:4000/assets/js/modernizr-2.5.3-respond-1.1.0.min.js"></script>
</head>
<body class="post post-2011-03-20-regular-expression-to-parse-word-style-footnotes">
<!--[if lt IE 7]><p class=chromeframe>Your browser is <em>ancient!</em> <a href="http://browsehappy.com/">Upgrade to a different browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to experience this site.</p><![endif]-->

		<div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="#">Benjamin J. Balter</a>
          <div class="nav-collapse">
	        	<ul class="nav" role="menu">
		<li id="home" ><a href="http://localhost:4000">Home</a>
	
		<li id="7" ><a href="http://localhost:4000/about.html">About</a></li>
		
		<li id="" ><a href="http://localhost:4000/categories/">Categories</a></li>
		
		<li id="10" ><a href="http://localhost:4000/contact.html">Contact</a></li>
		
		<li id="1931" ><a href="http://localhost:4000/donate.html">Donate</a></li>
		
		<li id="462" ><a href="http://localhost:4000/fine-print.html">Fine Print</a></li>
		
		<li id="12" ><a href="http://localhost:4000/resume.html">Resume</a></li>
		
		<li id="" ><a href="http://localhost:4000/tags/">Tags</a></li>
		
	</ul>

          </div>
        </div>
      </div>
    </div>

<div class="container-fluid">

<header>
	<div class="row-fluid">
    	<div class="span12">
        	<div class="hero-unit">
            	<h1 role="banner"><a href="http://localhost:4000">Benjamin J. Balter</a></h1>
            	<h2 class="description">J.D./M.B.A. Candidate, Open-Source Developer, Gov 2.0 Evangelist</h2>
            </div>
        </div>
    </div>
</header>

<article id="post-2011-03-20-regular-expression-to-parse-word-style-footnotes" class="post post-2011-03-20-regular-expression-to-parse-word-style-footnotes">
	<h2 class="title"><a href="http://localhost:4000/2011/03/20/regular-expression-to-parse-word-style-footnotes/">Regular Expression to Parse Word-style Footnotes into WordPress's Simple Footnotes Format</a></h2> 

	<div class="post-meta">
		<span class="entry-date">Posted on March 20, 2011</span> 
		<span class="entry-author">by Benjamin J. Balter</span>
	</div>
	    
    <div class="entrybody">
      I needed a quick-and-easy way to parse Microsoft Word’s footnote format into a more web-friendly format for a recent project. After a bit of regular expression hacking, I was able to build a WordPress plugin to automatically convert content pasted from Word into a format readable by [Andrew Nacin’s][1] popular [Simple Footnotes][2] plugin.  
<!--more-->

  
The process is surprisingly simple given [WordPress’s extensive filter API][3]. First, to grab the footnotes from Word’s `ftnref` format:

<pre class="brush: php; title: ; notranslate" title="">//grab all the Word-style footnotes into an array
$pattern = '#&lt;a href\=&quot;\#_ftnref([0-9]+)&quot;&gt;\[([0-9]+)\]&lt;/a&gt; (.*)#';
preg_match_all( $pattern, $content, $footnotes, PREG_SET_ORDER);
</pre>

This creates an array (`$footnotes`) with the both the footnote number and the text of the footnote. We then need a way to replace the in-text reference with the parsed footnotes so that Simple Footnotes can understand them. I did this by creating two arrays, a find array and a replace array with each Word-style footnote reference and its Simple Footnote formatted counterpart:

<pre class="brush: php; title: ; notranslate" title="">//build find and replace arrays
foreach ($footnotes as $footnote) {
    $find[] = '#&lt;a href\=&quot;\#_ftn'.$footnote[1].'&quot;&gt;\['.$footnote[1].'\]&lt;/a&gt;#';
    $replace[] = '[ref]' . str_replace( array(&quot;\r\n&quot;, &quot;\r&quot;, &quot;\n&quot;), &quot;&quot;, $footnote[3]) . '[/ref]';
}
</pre>

Finally, so that the entire replacement can be done in a single pass, push a final find/replace pair into the end of the array, to remove the original footnotes:

<pre class="brush: php; title: ; notranslate" title="">//remove all the original footnotes when done
$find[] = '#&lt;div&gt;\s*&lt;a href\=&quot;\#_ftnref([0-9]+)&quot;&gt;\[([0-9]+)\]&lt;/a&gt; (.*)\s*&lt;/div&gt;\s+#';
$replace[] = '';
</pre>

Because PHP’s `preg_replace` function can handle arrays, all we have to do is run a single function:

<pre class="brush: php; title: ; notranslate" title="">$content = preg_replace( $find, $replace, $content );
</pre>

Putting it all together, including a filter hook to call our function and a `meta_value` flag to prevent parsing on subsequent saves, the result is:

<pre class="brush: php; title: ; notranslate" title="">/*
Plugin Name: Convert Footnotes
Plugin URI: http://ben.balter.com/2011/03/20/regular-expression-to-parse-word-style-footnotes/
Description: Converts Word Footnotes to Simple Footnotes format. Requires Simple Footnotes installed, available at: http://wordpress.org/extend/plugins/simple-footnotes/
Version: 0.1
Author: Benjamin J. Balter
Author URI: http://ben.balter.com/
Revised by Marc Chehab: http://www.marcchehab.org/
*/

/**
 * Function which uses regular expression to parse Microsoft Word footnotes
 * into WordPress's Simple Footnotes format
 *
 * @link http://ben.balter.com/2011/03/20/regular-expression-to-parse-word-style-footnotes/
 * @param string $content post content from filter hook
 * @returns string post content with parsed footnotes
 */

function bb_parse_footnotes( $content ) {

	global $post;
	if ( !isset( $post ) )
		return;

	//if we have already parsed, kick
	if ( get_post_meta($post-&gt;ID, 'parsed_footnotes') )
		return $content;

	$content = stripslashes( $content );

	//grab all the Word-style footnotes into an array
	$pattern = '/\&lt;a( title\=\&quot;\&quot;)? href\=\&quot;[^\&quot;]*\#_ftnref([0-9]+)\&quot;\&gt;\[([0-9]+)\]\&lt;\/a\&gt;(.*)/';
	preg_match_all( $pattern, $content, $footnotes, PREG_SET_ORDER);

	//build find and replace arrays
	foreach ($footnotes as $footnote) {
		$find[] = '/\&lt;a( title\=\&quot;\&quot;)? href\=\&quot;[^\&quot;]*\#_ftn'.$footnote[2].'\&quot;\&gt;(\&lt;strong\&gt;)?\['.$footnote[2].'\](\&lt;\/strong\&gt;)?\&lt;\/a\&gt;/';
		$replace[] = ' <a class="simple-footnote" title="&#039; . str_replace( array(&quot;\r\n&quot;, &quot;\r&quot;, &quot;\n&quot;), &quot;&quot;, $footnote[4]) . &#039;" id="return-note-2020-1" href="#note-2020-1"><sup>1</sup></a>';
	}

	//remove all the original footnotes when done
	$find[] = '/\&lt;div\&gt;\s*(\&lt;p\&gt;)?\&lt;a( title\=\&quot;\&quot;)? href\=\&quot;[^\&quot;]*\#_ftnref([0-9]+)\&quot;\&gt;\[([0-9]+)\]\&lt;\/a\&gt;(.*)\s*\&lt;\/div\&gt;\s+/s';
	$replace[] = '';

	//make the switch
	$content = preg_replace( $find, $replace, $content );

	//add meta so we know it has been parsed
	add_post_meta($post-&gt;ID, 'parsed_footnotes', true, true);

	return addslashes($content);
}


add_filter( 'content_save_pre', 'bb_parse_footnotes' );
</pre>

To use, you can [download the plugin file][4] and activate (be sure you already have [Simple Footnotes][2] installed). Copy the content from Word, and Paste into the “*Paste from Word*” box (may need to toggle the “[*Kitchen Sink*][5]“.

Thoughts? Improvements? The above code solved a rather stubborn workflow problem in a project I was working on, and hopefully it can do the same for you. Feel free to use/improve the above code. <a class="simple-footnote" title="Licensed under GPLv2" id="return-note-2020-2" href="#note-2020-2"><sup>2</sup></a> You can even [Fork the plugin over on Github][6].

<div class="simple-footnotes">
  <p class="notes">
    Notes:
  </p>
  
  <ol>
    <li id="note-2020-1">
      ' . str_replace( array(&quot;\r\n&quot;, &quot;\r&quot;, &quot;\n&quot;), &quot;&quot;, $footnote[4]) . ' <a href="#return-note-2020-1">↩</a>
    </li>
    <li id="note-2020-2">
      Licensed under <a href="http://wordpress.org/about/gpl/">GPLv2</a> <a href="#return-note-2020-2">↩</a>
    </li>
  </ol>
</div>

 [1]: http://andrewnacin.com
 [2]: http://andrewnacin.com/2010/07/24/simple-footnotes-0-3/
 [3]: http://codex.wordpress.org/Plugin_API/Filter_Reference
 [4]: https://github.com/benbalter/Convert-Microsoft-Word-Footnotes-to-WordPress-Simple-Footnotes
 [5]: http://www.bloggingteacher.com/writing-posts-with-the-wordpress-visual-editor-the-kitchen-sink
 [6]: http://ben.balter.com/2011/03/20/regular-expression-to-parse-word-style-footnotes/
    </div>
    
    <div class="post-taxonomies">
  		Posted in 

<span class="term-list term-list-categories"><a href="http://localhost:4000/categories/#["technology"]">Technology</a></span> |
		Tagged 

<span class="term-list term-list-tags"></span>		
    </div>
</article>



     <footer>
        <p>&copy; Company 2012</p>
      </footer>
      
     </div><!--/.fluid-container-->
           
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script>window.jQuery || document.write('<script src="http://localhost:4000/javascript/jquery.js"><\/script>')</script>
	<script src="http://localhost:4000/assets/js/js.js"></script>
	<script>
	var _gaq=[['_setAccount','UA-XXXXX-X'],['_trackPageview']];
	(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
	g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
	s.parentNode.insertBefore(g,s)}(document,'script'));
</script>
</body>
</html>
<!-- Generated 2012-08-18 17:27:47 -0400 -->